k.titration <- c(n %/% 2, n %/% 5, n %/% 10, n %/% 20, n %/% 50, n %/% 100, n %/% 200)
ideal.knn <- impute.testing(k.titration = k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
wand.combined <- process.multiple.files(files = files, numcells = 500, input = input.markers)
ideal.knn
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 25)
set.seed(139245)
wand.basal <- process.multiple.files(files = files[grep("basal", files)], numcells = 500, input = input.markers)
wand.il7 <- process.multiple.files(files = files[grep("IL7", files)], numcells = 500, input = input.markers)
n <- 500
k.titration <- c(n %/% 2, n %/% 5, n %/% 10, n %/% 20, n %/% 50, n %/% 100, n %/% 200)
ideal.knn <- impute.testing(k.titration = k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
wand.combined <- process.multiple.files(files = files, numcells = 500, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 25)
ideal.knn
wand.scone <- scone.values(nn.matrix = wand.nn, cell.data = wand.combined, scone.markers = funct.markers, unstim = "basal")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
wand.final
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.change`)
wand.final$`pSTAT5(Nd150)Di.IL7.change`
wand.nn
wand.basal
wand.il7
wand.combined <- process.multiple.files(files = files, numcells = 5000, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 25)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
wand.combined <- process.multiple.files(files = files, numcells = 1000, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
wand.combined <- process.multiple.files(files = files, numcells = 10000, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 100)
unique(wand.combined$condition
)
wand.combined <- process.multiple.files(files = files, numcells = 10000, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 100)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
n <- 5000
set.seed(139245)
n <- 5000
wand.basal <- process.multiple.files(files = files[grep("basal", files)], numcells = n, input = input.markers)
wand.il7 <- process.multiple.files(files = files[grep("IL7", files)], numcells = n, input = input.markers)
k.titration <- c(n %/% 2, n %/% 5, n %/% 10, n %/% 20, n %/% 50, n %/% 100, n %/% 200)
ideal.knn <- impute.testing(k.titration = k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
wand.combined <- process.multiple.files(files = files, numcells = 5000, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
n <- 1000
wand.basal <- process.multiple.files(files = files[grep("basal", files)], numcells = n, input = input.markers)
wand.il7 <- process.multiple.files(files = files[grep("IL7", files)], numcells = n, input = input.markers)
wand.combined <- process.multiple.files(files = files, numcells = n, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal")
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
set.seed(139245)
n <- 1000
wand.basal <- process.multiple.files(files = files[grep("basal", files)], numcells = n, input = input.markers)
wand.il7 <- process.multiple.files(files = files[grep("IL7", files)], numcells = n, input = input.markers)
k.titration <- c(n %/% 2, n %/% 5, n %/% 10, n %/% 20, n %/% 50, n %/% 100, n %/% 200)
ideal.knn <- impute.testing(k.titration = k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
wand.combined <- process.multiple.files(files = files, numcells = n, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 25)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "t")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
ylab("pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.change`) +
labs(color = "pSTAT5")
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "t")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.change`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
k.titration <- c(n %/% 2, n %/% 5, n %/% 10, n %/% 20, n %/% 50, n %/% 100, n %/% 200)
ideal.knn <- impute.testing(k.titration = k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
ideal.knn
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 20)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "t")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.change`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 100)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "t")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "t")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.change`) +
labs(color = "pSTAT5")
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "mwu")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.change`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 20)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "mwu")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "mwu")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
object.size(final)
object.size(wand.final)
object.size(wand.final)/10^6
object.size(wand.combined)/10^6
object.size(wand.nn)/10^6
files <- list.files() %>% .[grep("fcs", .)]
set.seed(139245)
n <- 1000
wand.basal <- process.multiple.files(files = files[grep("basal", files)], numcells = n, input = input.markers)
wand.il7 <- process.multiple.files(files = files[grep("IL7", files)], numcells = n, input = input.markers)
wand.k.titration <- c(n %/% 2, n %/% 5, n %/% 10, n %/% 20, n %/% 50, n %/% 100, n %/% 200)
wand.ideal.k <- impute.testing(k.titration = k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
wand.combined <- process.multiple.files(files = files, numcells = n, input = input.markers)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 50)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "mwu")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
object.size(wand.final)/10^6
object.size(wand.combined)/10^6
object.size(wand.nn)/10^6
wand.k.titration <- c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100)
wand.ideal.k <- impute.testing(k.titration = k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
wand.k.titration <- c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100)
wand.ideal.k <- impute.testing(k.titration = wand.k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
wand.ideal.k
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 30)
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "mwu")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.change`) +
labs(color = "pSTAT5")
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
# Date: January 7, 2018
# Procedure: subsampling the existing data to make it fit into the package
# Purpose: to limit the size of the package to 5mb
################# SETUP #################
library(Sconify)
library(tidyverse)
################# FUNCTIONS #################
# Subsamples a given data matrix
# Args:
#   dat: a tibble of cells by fetures
#   n: the desired number of rows in dat
# Returns:
#   the subsapled tibble of cells by features
subsample <- function(dat, n) {
result <- dat[sample(1:nrow(dat), n),]
return(result)
}
################# PIPELINE #################
# Wanderlust dataset
files <- list.files() %>% .[grep("fcs", .)]
set.seed(139245)
n <- 1000
wand.basal <- process.multiple.files(files = files[grep("basal", files)], numcells = n, input = input.markers)
wand.il7 <- process.multiple.files(files = files[grep("IL7", files)], numcells = n, input = input.markers)
# Finding ideal knn
wand.k.titration <- c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100)
wand.ideal.k <- impute.testing(k.titration = wand.k.titration,
cells = wand.il7,
input.markers = input.markers,
test.markers = funct.markers)
# Get combined data
wand.combined <- process.multiple.files(files = files, numcells = n, input = input.markers)
# Find KNN (we use a k of 50 because it empirically found ground truth)
wand.nn <- fnn(cell.df = wand.combined, input.markers = input.markers, k = 30)
# KNN comparisons
wand.scone <- scone.values(nn.matrix = wand.nn,
cell.data = wand.combined,
scone.markers = funct.markers,
unstim = "basal", stat.test = "mwu")
wand.final <- post.processing(scone.output = wand.scone,
cell.data = wand.combined,
input = input.markers)
# Testing
max(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
hist(wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`)
qplot(wand.final$`bh-SNE1`, wand.final$`bh-SNE2`, color = wand.final$`pSTAT5(Nd150)Di.IL7.qvalue`) +
labs(color = "pSTAT5")
# Size of the data structures
object.size(wand.final)/10^6
object.size(wand.combined)/10^6
object.size(wand.nn)/10^6
library(devtools)
use_data(wand.basal, package = "Sconify")
wand.basal
use_data(wand.basal, package = "Sconify")
?use_data
setwd("~/Documents/local.R.projects/Sconify")
use_data(wand.basal)
use_data(wand.basal)
use_data(wand.il7)
use_data(wand.ideal.k)
use_data(wand.k.titration)
use_data(wand.nn)
use_data(wand.scone)
use_data(wand.final)
use_data(wand.combined)
document()
library(Sconify)
dir()
wand.knn.list <- make.knn.list(cell.data = wand.combined, nn.matrix = wand.nn)
library(Sconify)
devtools::document()
roxygen2::roxygenise()
wand.basal
k.titration
devtools::document()
input.markers
devtools::document()
devtools::document()
devtools::document()
wand.combined
ex.knn <- fnn(wand.combined, input.markers)
make.knn.list(wand.combined, ex.knn)
ex.knn <- fnn(wand.combined, input.markers, k = 30)
knn.list <- make.knn.list(wand.combined, ex.knn)
knn.list
devtools::document()
library(Sconify)
k.titration
wand.k.titration
k.titration
devtools::document()
wand.ideal.k
rep(1:100, by = 10)
rep(100, by = 10)
?rep
1:100[1:100 %% 10 == 1]
1:100[1:100 %% 10 == 0]
1:100[1:100 %/% 10 == 0]
test <- 10:100
test <- 1:100
test[test %/% 10 == 0]
test %/% 10
test[test / 10 == 0]
test/10
test %% 10
test[test %% 10 == 0]
wand.k.titration <- 1:100 %>% .[. %% 10 == 0]
wand.k.titration
wand.ideal.k
devtools::document()
k.titration
devtools::document()
k.titration
devtools::document
devtools::document()
bz.gmcsf.final
bz.gmcsf.final <- subsample(bz.gmcsf.final, 1000)
bz.gmcsf.final.norm.scale <- subsample(bz.gmcsf.final.norm.scale, 1000)
use_data(bz.gmcsf.final, overwrite = TRUE)
use_data(bz.gmcsf.final.norm.scale, overwrite = TRUE)
devtools::document()
library(Sconify)
0.5/sqrt(30)
setwd("~/Documents/local.R.projects/Sconify.optimizations.round.2/data.shrinking/fcs.subsample")
files <- list.files() %>% .[grep("fcs", .)]
files
basal <- files[grep("basal", files)]
il7 <- files[grep("il7", files)]
basal.data <- read.FCS(basal)
str(basal.data)
basal.data[1]
basal.data <- read.FCS(basal) %>% .[1:1000]
basal.data <- read.FCS(basal) %>% .[1:1000]
il7.data <- read.FCS(il7) %>% .[1:1000]
il7
il7 <- files[grep("il7", files)]
basal.data <- read.FCS(basal) %>% .[1:1000]
il7.data <- read.FCS(il7) %>% .[1:1000]
il7
il7 <- files[grep("IL7", files)]
basal.data <- read.FCS(basal) %>% .[1:1000]
il7.data <- read.FCS(il7) %>% .[1:1000]
files
write.FCS(basal.data, basal)
write.FCS(il7.data, il7)
devtools::document()
library(Sconify)
wand.combined
wand.combined.input
setwd("~/Documents/local.R.projects/Sconify")
BiocCheck(getwd())
library(Sconify)
devtools::build()
wand.scone
wand.basal
devtools::document()
devtools::build()
devtools::check()
library(Sconify)
library(Sconify)
devtools::document()
?flowCore
devtools::document()
devtools::document()
document()
document()
document()
document()
document(
)
?pipe
?%?%
?%>%
?`%>%``
?`%>%`
devtools::document()
document()
devtools::document()
devtools::document()
devtools::document()
library(Sconify)
devtools::document()
document()
document()
document()
document()
document()
library(Sconify)
documenrt()
document()
document()
devtools::document()
roxygen2::roxygenize()
document()
BioCheck(getwd())
library(BiocCheck)
BiocCheck(getwd())
library(Sconify)
dir()
getwd()
library(BiocCheck)
BioCheck(getwd())
?BiocCheck
BiocCheck(getwd())
library(Sconify)
library(Sconify)
library(Sconify)
?make.hist
make.hist
library(Sconify)
getwd()
BiocCheck::BiocCheck(getwd())
BiocCheck::BiocCheck(getwd())
version()
version
